<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">

    <title>Lecture 09.01.2019 - Flink</title>

    <meta name="author" content="Roman Bartusiak">

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/black.css" id="theme">

    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="lib/css/zenburn.css">

    <!-- Printing and PDF exports -->
    <script>
        var link = document.createElement( 'link' );
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
        document.getElementsByTagName( 'head' )[0].appendChild( link );
    </script>

        <!--[if lt IE 9]>
        <script src="lib/js/html5shiv.js"></script>
    <![endif]-->
    <style>
    .reveal pre code{
        max-height: initial;
    }
    .reveal pre{
        background: #3f3f3f;
    }
</style>
</head>

<body>

    <div class="reveal">

        <!-- Any section element inside of this container is displayed as a slide -->
        <div class="slides">
            <section>
                <h1>Apache Flink</h1>
                <h3>Roman Bartusiak</h3>
            </section>

            <section>
                <section>
                    <h2>General</h2>
                    <ul>
                        <li>Stephan Ewen</li>
                        <li>data Artisans</li>
                        <li>TU Berlin</li>
                        <li>Huge community</li>
                        <li>JVM</li>
                    </ul>
                </section>
            </section>
            <section>
                <section>
                    <h2>Dataflow programming model</h2>
                    <img src="img/flink-abstractions.svg" alt="" style="width:80%"/>
                </section>
                <section>
                    <ul>
                        <li>Stateful streams</li>
                        <li>DataStream</li>
                        <li>Table API - under development</li>
                        <li>SQL - under development</li>
                    </ul>
                </section>
                <section>
                    <ul>
                        <li>Source</li>
                        <li>Transformation</li>
                        <li>Sink</li>
                    </ul>
                </section>
                <section>
                    <img src="img/flink-dag.svg" alt="" style="width:80%">
                </section>
                <section>
                    <ul>
                        <li>
                            Program
                            <ol>
                                <li>
                                    Task
                                    <ol>
                                        <li>
                                            Subtask
                                            <li>
                                                Subtask
                                            </li>
                                            <li>
                                                ...
                                            </li>
                                        </ol>
                                    </li>
                                    <li>
                                        Task
                                    </li>
                                    <li>
                                        ...
                                    </li>
                                </ol>
                            </li>
                        </ul>
                    </section>
                    <section>
                        <h3>Dataflow Graph</h3>
                        <ul>
                            <li>Directed Acyclic Graph - but not exactly</li>
                            <li>Represents computations</li>
                            <li>We are not doing computations in our code, we are creating graphs and executing them</li>
                        </ul>
                    </section>
                    <section>
                        <h3>Parallelism</h3>
                        <ul>
                            <li>operator</li>
                            <li>execution environent</li>
                            <li>client</li>
                            <li>system wide</li>
                        </ul>
                    </section>
                    <section>
                        <h3>Data transport</h3>
                        <ul>
                            <li>one-to-one - preserver ordering and partitioning</li>
                            <li>redistributing - each event can have different target subtask</li>
                        </ul>
                    </section>
                    <section>
                        <img src="img/flink-dag.svg" alt="" style="width:80%">
                    </section>
                    <section>
                        <h3>Windows</h3>
                        <ul>
                            <li>time driven</li>
                            <li>data driven</li>
                            <li>tumbling - no overlap</li>
                            <li>sliding - overlap</li>
                            <li>session - punctuated by inactivity</li>
                        </ul>
                    </section>
                    <section>
                        <img src="img/flink-windows.svg" alt="" style="width:80%">
                    </section>
                    <section>
                        <h3>Time</h3>
                        <ul>
                            <li>Creation</li>
                            <li>Ingestion</li>
                            <li>Processing</li>
                        </ul>
                    </section>
                    <section>
                        <img src="img/flink-time.svg" alt="" style="width:80%">
                    </section>
                    <section>
                        <h3>Stateful Operators</h3>
                        <ul>
                            <li>transparent</li>
                            <li>key/value store</li>
                            <li>requires keyBy()</li>
                        </ul>
                    </section>
                    <section>
                        <img src="img/flink-stateful.svg" alt="" style="width:70%">
                    </section>
                    <section>
                        <h3>Fault tolerance</h3>
                        <ul>
                            <li>stream reply</li>
                            <li>checkpointing</li>
                        </ul>
                    </section>
                    <section>
                        <h3>Batch</h3>
                        <ul>
                            <li>data as a stream source</li>
                            <li>no checkpointing</li>
                        </ul>
                    </section>
                </section>
                <section>
                    <section>
                        <h2>Flink architecture</h2>
                        <img src="img/flink-architecture.svg" alt="Flink architecture" style="width:80%">
                    </section>
                    <section>
                        <ul>
                            <li>many Job Managers (Drivers) - many Task Managers (Workers)</li>
                            <li>Applications are SHARING JVM</li>
                            <li>Each node must be able to connect to all other nodes</li>
                        </ul>
                    </section>
                    <section>
                        <ul>
                            <li>Flink program - our main() (or remote environment execution), defines Dataflow</li>
                            <li>Job Manager - executes our Dataflow, schedules Dataflow graph, manages checkpointing</li>
                            <li>Task manager - executes subtasks from Dataflow, can be configured by number of task slots</li>
                        </ul>
                    </section>
                    <section>
                        <img src="img/flink-tasks.svg"  style="width:80%">
                    </section>
                    <section>
                        Tune number of task slots per task manager
                        <ul>
                            <li>
                                one task slot per task manager - spearate JVM for tasks
                            </li>
                            <li>
                                more than one task slot per task manager - tasks share JVM, no CPU isolation, only memory management
                            </li>
                        </ul>
                    </section>

                </section>

                <section>
                    <h2>Flink components</h2>
                    <img src="img/flink-stack.png" alt="Flink stack">
                </section>
                <section>
                    <section>
                        <h2>Runtimes</h2>
                        <ul>
                            <li>Local JVM</li>
                            <li>Standalone</li>
                            <li>YARN</li>
                            <li>Mesos</li>
                            <li>Cloud</li>
                        </ul>
                    </section>
                    <section>
                        <h3>Local JVM</h3>
                        <pre>
                            <code class="hljs java"  data-trim data-noescape>
                                ExecutionEnvironment.getExecutionEnvironment()
                            </code>
                        </pre>
                    </section>
                    <section>
                        <h3>Standalone</h3>
                        <ul>
                            <li>
                                Simply: 
                                <ul>
                                    <li>Create configurat1ion</li>
                                    <li>Put up job manager</li>
                                    <li>Add task managers to cluster</li>
                                </ul>
                            </li>
                        </ul>
                    </section>
                    <section>
                        <h3>Remote</h3>
                        <pre>
                            <code class="hljs java"  data-trim data-noescape> 
                                ExecutionEnvironment
                                   .createRemoteEnvironment("flink-master",
                                                             8081,
                                                             "/home/user/udfs.jar");
                            </code>
                        </pre>
                    </section>
                </section>
                <section>
                    <section>
                        <h2>Basic API</h2>
                    </section>
                    <section>
                        <ul>
                            <li>Create execution environment</li>
                            <li>Load initial data</li>
                            <li>Transform data</li>
                            <li>Specify where to put results</li>
                            <li>Execute program</li>
                        </ul>
                    </section>
                    <section>
                        <ul>
                            <li>LAZY EVALUATION</li>
                            <li>join, coGroup, keyBy, groupBy - requires keys</li>
                            <li>Reduce, GroupReduce, Aggregate, Windows - keys are optional</li>
                            <li>keys are virtual</li>
                        </ul>
                    </section>
                    <section>
                        <pre>
                            <code class="hljs scala"  data-trim data-noescape> 
                                val input: DataStream[(Int, String, Long)] = ???
                                val keyed = input.keyBy(0)
                            </code>
                        </pre>
                    </section>
                    <section>
                        <pre>
                            <code class="hljs scala"  data-trim data-noescape> 
                                val input: DataSet[(Int, String, Long)] = ???
                                val grouped = input.groupBy(0,1)
                            </code>
                        </pre>
                    </section>
                    <section>
                        <h3>Keys using Field Expressions</h3>
                        <ul>
                            <li>"field" - field name</li>
                            <li>"_1", "0" - tuple elements </li>
                            <li>"_1._1" - nested fields</li>
                            <li>"_" - whole type</li>
                        </ul>
                    </section>
                    <section data-background="https://media.giphy.com/media/KajpERDjOpMcw/giphy.gif">
                        <h3>NO TYPES??!!</h3>
                    </section>
                    <section>
                        <pre>
                            <code class="hljs scala"  data-trim data-noescape> 
                                case class WC(word: String, count: Int)
                                val words: DataStream[WC] = // [...]
                                val keyed = words.keyBy( _.word )
                            </code>
                        </pre>
                    </section>
                    <section data-background="https://media.giphy.com/media/i79P9wUfnmPyo/giphy.gif">
                        <h3>TYPES!!!</h3>
                    </section>
                    <section>
                        <h3>Transformations</h3>
                        <ul>
                            <li>map, reduce, etc.</li>
                            <li>rich functions</li>
                        </ul>
                    </section>
                    <section>
                        <h3>Accumulators</h3>
                        <ul>
                            <li>add</li>
                            <li>result</li>
                        </ul>
                    </section>
                </section>
                <section>
                    <section>
                        <h2>DataStream API</h2>
                    </section>
                    <section>
                        <h3>Sources</h3>
                        <ul>
                            <li>text file</li>
                            <li>file</li>
                            <li>socket</li>
                            <li>collections</li>
                            <li>connectors</li>
                        </ul>
                    </section>
                    <section>
                        <h4>Sources - connectors</h4>
                        <ul>
                            <li>Kafka</li>
                            <li>Amazon Kinesis</li>
                            <li>RabitMQ</li>
                            <li>NiFi</li>
                            <li>Twitter</li>
                        </ul>
                    </section>
                    <section>
                        <h3>Transformations</h3>
                        <ul>
                            <li>map - N -> R </li>
                            <li>flatMap - N -> DataStream[R]</li>
                            <li>filter - N -> N</li>
                            <li>keyBy - N -> KeyedStream[N, K]</li>
                            <li>reduce - N -> N</li>
                        </ul>
                    </section>
                    <section>
                        <ul>
                            <li>fold - N -> K </li>
                            <li>sum, min, max, minBy, maxBy</li>
                            <li>window - KeyedStream[N, K] -> WindowedStream[N, K, W]</li>
                            <li>!!! windowAll - N -> AllWindowStream[N, W]</li>
                            <li>union</li>
                        </ul>
                    </section>
                    <section>
                        <ul>
                            <li>join</li>
                            <li>connect (DataStream[N], Datastream[K]) -> ConnectedStream[N, K]</li>
                            <li>split DataStream[N] -> SplitStream[N]</li>
                        </ul>
                    </section>
                    <section>
                        <h3>Sinks</h3>
                        <ul>
                            <li>text file</li>
                            <li>CSV</li>
                            <li>file</li>
                            <li>socket</li>
                            <li>connectors</li>
                        </ul>
                    </section>
                    <section>
                        <h4>Sinks - connectors</h4>
                        <ul>
                            <li>Kafka</li>
                            <li>Cassandra</li>
                            <li>Amazon Kinesis</li>
                            <li>Elasticsearch</li>
                            <li>HDFS</li>
                            <li>RabitMQ</li>
                            <li>NiFi</li>
                        </ul>
                    </section>
                    <section>
                        <h4>Async IO</h4>
                        <img src="img/flink-async-io.svg" >
                    </section>
                    <section>
                        <h4>Buffering</h4>
                        <ul>
                            <li>latency</li>
                            <li>throughput</li>
                        </ul>
                    </section>
                </section>
                <section>
                    <section>
                        <h2>DataSet API</h2>
                    </section>
                </section>
                <section>
                    <section>
                        <h2>Flink Complex Event Processing (CEP) stream</h2>
                    </section>
                </section>
                <section>
                    <section>
                        <h2>Table API & SQL - stream & batch</h2>
                    </section>
                </section>
                <section>
                    <section>
                        <h2>FlinkML - batch</h2>
                    </section>
                </section>
                <section>
                    <section>
                        <h2>Gelly - batch</h2>
                    </section>
                </section>
            </div>

        </div>

        <script src="lib/js/head.min.js"></script>
        <script src="js/reveal.js"></script>

        <script>

            // More info https://github.com/hakimel/reveal.js#configuration
            Reveal.initialize({
                slideNumber: 'c/t',
                controls: true,
                progress: true,
                history: true,
                center: true,

                transition: 'slide', // none/fade/slide/convex/concave/zoom

                // More info https://github.com/hakimel/reveal.js#dependencies
                dependencies: [
                { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
                { src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
                { src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
                { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
                { src: 'plugin/search/search.js', async: true },
                { src: 'plugin/zoom-js/zoom.js', async: true },
                { src: 'plugin/notes/notes.js', async: true },
                { src: 'node_modules/reveal.js-tableofcontents/tableofcontents.js' }
                ],
                tableofcontents: {
        // Specifies the slide title of the table of contents slide
        title: "Agenda",

        // Specifies the position of the table of contents slide in the presentation
        position: 2,

        // Specifies which slide tag elements will be used
        // for generating the table of contents.
        titleTagSelector: "h2",

        // Specifies if the first slide, mostly the title slide of the presentation, should be ignored.
        ignoreFirstSlide: true,

        // Specifies if every single element of the table of contents
        // will be stepped through before moving on to the next slide.
        fadeInElements: false
    }
});

</script>

</body>
</html>
